# Database Diagrams

This directory contains database schema diagrams in various formats.

## Files

### Manual Diagrams (draw.io)

- `entity_diagram_v1.0.drawio` - Initial schema baseline
- `entity_diagram_v1.1.drawio` - Phase 1 (Authentication)
- `entity_diagram_v2.0.drawio` - Phase 2 (Contract Parsing) - to be created

These diagrams are manually maintained using draw.io. To update:
1. Run `./scripts/document-migration.sh <migration-file>` to see what changed
2. Open the appropriate version in draw.io
3. Add/modify tables and relationships based on migration summary

### Auto-Generated Diagrams

- `schema.mermaid.md` - Auto-generated Mermaid ERD (updated by GitHub Actions)

This file is automatically generated when changes are pushed to `database/migrations/` or `database/versions/`. View it:
- **GitHub**: Navigate to the file and GitHub will render it automatically
- **VS Code**: Open and press Cmd+Shift+V for preview
- **Mermaid Live**: Copy content to https://mermaid.live

### Exports (Optional)

The `exports/` directory can store exported images from draw.io diagrams:
- `entity_diagram_v1.0.png`
- `entity_diagram_v1.1.png`
- etc.

To export from draw.io:
1. File → Export as → PNG/SVG
2. Save to `exports/` directory
3. Commit to version control

## Workflow

### When Creating a Migration:

```bash
# 1. Document migration changes
./scripts/document-migration.sh database/migrations/002_add_contract_pii_mapping.sql

# 2. Update draw.io diagram based on output
# Open database/diagrams/entity_diagram_v2.0.drawio

# 3. Run migration
psql $SUPABASE_DB_URL -f database/migrations/002_add_contract_pii_mapping.sql
```

### After Completing a Phase:

```bash
# 1. Create snapshot
./scripts/create-phase-snapshot.sh v2.0 "Phase 2 - Contract Parsing"

# 2. Export draw.io diagram (optional)
# File → Export as → PNG → Save to exports/

# 3. Commit everything
git add database/versions/v2.0_snapshot.sql \
        database/SCHEMA_CHANGES.md \
        database/diagrams/entity_diagram_v2.0.drawio \
        database/diagrams/exports/entity_diagram_v2.0.png

git commit -m "Schema snapshot v2.0: Phase 2 Contract Parsing Complete"
git push

# 4. GitHub Action automatically generates Mermaid diagram
```

## Viewing Diagrams

- **draw.io files**: Open with draw.io desktop app or https://app.diagrams.net
- **Mermaid files**: View on GitHub, VS Code preview, or https://mermaid.live
- **PNG/SVG exports**: Any image viewer
